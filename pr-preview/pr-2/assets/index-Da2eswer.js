var x=Object.defineProperty;var I=(n,e,t)=>e in n?x(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var s=(n,e,t)=>I(n,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";function u(n){return n instanceof HTMLElement}function E(n){return n instanceof HTMLButtonElement}function g(n){if(n<=0)throw new Error("max value must be a positive integer");const{crypto:e}=window,t=new Uint32Array(1);return e.getRandomValues(t),1+Math.floor(t[0]%n)}class h{constructor(){s(this,"_subscribers",new Set)}subscribe(e){this._subscribers.add(e)}get subscribers(){return this._subscribers}unsubscribe(e){this._subscribers.has(e)&&this._subscribers.delete(e)}notify(e){this.subscribers.forEach(t=>t.update(e))}}class w extends h{constructor(e){super(),this.sidesCount=e}roll(e){const t=g(this.sidesCount);return{playerIndex:e,diceResult:t}}update(e){const t=this.roll(e);this.notify(t)}}const R=21;class P{constructor(e){s(this,"diceResults",[]);s(this,"winStatus",new h);s(this,"result",new h);s(this,"playerIndex");this.playerIndex=e}get index(){return this.playerIndex}get totalScore(){return this.diceResults.reduce((e,t)=>e+t,0)}update(e){e.playerIndex===this.playerIndex&&(this.diceResults.push(e.diceResult),this.result.notify(this.diceResults),this.totalScore>=R&&this.winStatus.notify(!0))}}class L extends h{constructor(t){super();s(this,"_currentPlayerIndex");this.playersCount=t,this._currentPlayerIndex=0}get currentPlayerIndex(){return this._currentPlayerIndex}notify(t){this.subscribers.forEach(r=>{r.update(t)}),this.next()}next(){this._currentPlayerIndex=(this._currentPlayerIndex+1)%this.playersCount}}class S{constructor(e,t){this.elementContainer=e,this.playerIndex=t}}class D extends S{update(e){if(!e)return;const t=this.elementContainer.querySelector("ul"),r=document.getElementById("roll-dice");u(t)&&E(r)&&(t.classList.add("pink"),r.disabled=!0)}}const i=class i extends S{setupLayout(){const t=document.createElement("h3");t.classList.add("currentIndex"),t.textContent=`Player ${this.playerIndex+1} - `;const r=document.createElement("span");r.textContent="0";const l=document.createElement("ul");l.classList.add("results"),t.appendChild(r),this.elementContainer.appendChild(t),this.elementContainer.appendChild(l)}update(e){var a,y;const t=e.at(-1)??0;i.totalScoreOfAllPlayer+=t;const r=(a=i.debugElement)==null?void 0:a.querySelector("span");u(r)&&(r.textContent=i.totalScoreOfAllPlayer.toString());const l=this.elementContainer.querySelector("span");u(l)&&(l.textContent=e.reduce((p,C)=>p+C,0).toString());const d=document.createElement("li");d.textContent=t.toString();const m=this.elementContainer.querySelector("ul");u(m)&&m.appendChild(d);const o=document.createElement("li");o.textContent=t.toString();const c=(y=i.debugElement)==null?void 0:y.querySelector("ul");u(c)&&c.appendChild(o)}};s(i,"debugElement",document.getElementById("debug")),s(i,"totalScoreOfAllPlayer",0);let b=i;const B=6,f=6;function A(){const n=new L(f),e=new w(B);n.subscribe(e),r(f);const t=document.getElementById("roll-dice");E(t)&&t.addEventListener("click",()=>{n.notify(n.currentPlayerIndex)});function r(l){const d=document.getElementById("player-container");return u(d)?Array.from({length:l},(m,o)=>{const c=new P(o),a=document.createElement("div");a.id=`player${o}`,d.appendChild(a);const y=new D(a,o),p=new b(a,o);return p.setupLayout(),e.subscribe(c),c.winStatus.subscribe(y),c.result.subscribe(p),c}):[]}}document.addEventListener("DOMContentLoaded",A);
