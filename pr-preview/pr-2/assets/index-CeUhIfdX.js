var E=Object.defineProperty;var I=(n,e,t)=>e in n?E(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>I(n,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";function C(n){return n instanceof HTMLButtonElement}function a(n){return n!=null}function g(n){const{crypto:e}=window,t=new Uint32Array(1);return e.getRandomValues(t),1+Math.floor(t[0]%n)}class h{constructor(){l(this,"_subscribers",[])}subscribe(e){this._subscribers.push(e)}get subscribers(){return this._subscribers}unsubscribe(e){this._subscribers=this.subscribers.filter(t=>t!==e)}notify(e){this.subscribers.forEach(t=>t.update(e))}}class P extends h{constructor(e){super(),this.sidesCount=e}roll(e){const t=g(this.sidesCount);return{playerIndex:e,diceResult:t}}update(e){const t=this.roll(e);this.notify(t)}}const R=21;class w{constructor(e){l(this,"diceResults",[]);l(this,"winStatus",new h);l(this,"result",new h);l(this,"playerIndex");this.playerIndex=e}get index(){return this.playerIndex}get getTotalScore(){return this.diceResults.reduce((e,t)=>e+t,0)}update(e){e.playerIndex===this.playerIndex&&(this.diceResults.push(e.diceResult),this.result.notify(this.diceResults),this.getTotalScore>=R&&this.winStatus.notify(!0))}}class D extends h{constructor(t){super();l(this,"currentPlayerIndex");this.playersCount=t,this.currentPlayerIndex=0}getCurrentPlayerIndex(){return this.currentPlayerIndex}notify(t){this.subscribers.forEach(r=>{r.update(t)}),this.next()}next(){this.currentPlayerIndex=(this.currentPlayerIndex+1)%this.playersCount}}class S{constructor(e,t){this.elementContainer=e,this.playerIndex=t}}class L extends S{update(e){if(!e)return;const t=this.elementContainer.querySelector("ul"),r=document.getElementById("roll-dice");a(t)&&C(r)&&(t.classList.add("pink"),r.disabled=!0)}}const i=class i extends S{setupLayout(){const t=document.createElement("h3");t.classList.add("currentIndex"),t.textContent=`Player ${this.playerIndex+1} - `;const r=document.createElement("span");r.textContent="0";const s=document.createElement("ul");s.classList.add("results"),t.appendChild(r),this.elementContainer.appendChild(t),this.elementContainer.appendChild(s)}update(e){var u,y;const t=e.at(-1)??-1;if(t===-1)return;i.totalScoreOfAllPlayer+=t;const r=(u=i.debugElement)==null?void 0:u.querySelector("span");a(r)&&(r.textContent=i.totalScoreOfAllPlayer.toString());const s=this.elementContainer.querySelector("span");a(s)&&(s.textContent=e.reduce((p,x)=>p+x,0).toString());const d=document.createElement("li");d.textContent=t.toString();const m=this.elementContainer.querySelector("ul");a(m)&&m.appendChild(d);const o=document.createElement("li");o.textContent=t.toString();const c=(y=i.debugElement)==null?void 0:y.querySelector("ul");a(c)&&c.appendChild(o)}};l(i,"debugElement",document.getElementById("debug")),l(i,"totalScoreOfAllPlayer",0);let b=i;const B=6,f=6;function A(){const n=new D(f),e=new P(B);n.subscribe(e),r(f);const t=document.getElementById("roll-dice");C(t)&&t.addEventListener("click",()=>{const s=n.getCurrentPlayerIndex();n.notify(s)});function r(s){const d=document.getElementById("player-container");return a(d)?Array.from({length:s},(m,o)=>{const c=new w(o),u=document.createElement("div");u.id=`player${o}`,d.appendChild(u);const y=new L(u,o),p=new b(u,o);return p.setupLayout(),e.subscribe(c),c.winStatus.subscribe(y),c.result.subscribe(p),c}):[]}}document.addEventListener("DOMContentLoaded",A);
